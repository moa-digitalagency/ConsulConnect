{% extends "base.html" %}

{% block title %}Autres Documents - e-Consulaire RDC{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card shadow">
            <div class="card-header bg-secondary text-white">
                <h4 class="mb-0">
                    <i class="fas fa-file-alt me-2"></i>Demande d'Autres Documents
                </h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h6 class="alert-heading">
                        <i class="fas fa-info-circle me-2"></i>Documents disponibles
                    </h6>
                    <ul class="mb-0">
                        <li>Attestations officielles diverses</li>
                        <li>Certificats de vie, de résidence, de nationalité</li>
                        <li>Duplicatas de documents consulaires</li>
                        <li>Frais de traitement: <strong>20 USD</strong></li>
                        <li>Délai de traitement: 3-5 jours ouvrables</li>
                    </ul>
                </div>

                <form method="POST" enctype="multipart/form-data" id="otherDocumentsForm">
                    {{ form.hidden_tag() }}
                    
                    <!-- Type de document -->
                    <div class="form-section mb-4">
                        <h5 class="border-bottom pb-2 mb-3">
                            <i class="fas fa-list me-2"></i>Type de Document
                        </h5>
                        
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                {{ form.document_type.label(class="form-label required") }}
                                {{ form.document_type(class="form-select" + (" is-invalid" if form.document_type.errors else "")) }}
                                {% if form.document_type.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.document_type.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div id="document_type_other_field" class="mb-3" style="display: none;">
                            {{ form.document_type_other.label(class="form-label") }}
                            {{ form.document_type_other(class="form-control" + (" is-invalid" if form.document_type_other.errors else ""), placeholder="Précisez le type d'attestation souhaité") }}
                            {% if form.document_type_other.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.document_type_other.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Objet et finalité -->
                    <div class="form-section mb-4">
                        <h5 class="border-bottom pb-2 mb-3">
                            <i class="fas fa-bullseye me-2"></i>Objet et Finalité
                        </h5>
                        
                        <div class="mb-3">
                            {{ form.purpose.label(class="form-label required") }}
                            {{ form.purpose(class="form-control" + (" is-invalid" if form.purpose.errors else ""), rows="4", placeholder="Expliquez précisément l'objet de votre demande et l'usage prévu du document") }}
                            {% if form.purpose.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.purpose.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">
                                Soyez précis sur l'usage prévu : démarches administratives, inscription, demande de visa, etc.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Documents justificatifs -->
                    <div class="form-section mb-4">
                        <h5 class="border-bottom pb-2 mb-3">
                            <i class="fas fa-paperclip me-2"></i>Documents Justificatifs
                        </h5>
                        
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Formats acceptés:</strong> JPG, PNG, PDF - Taille maximale: 5MB par fichier
                        </div>
                        
                        <div class="mb-3">
                            {{ form.supporting_documents.label(class="form-label required") }}
                            {{ form.supporting_documents(class="form-control" + (" is-invalid" if form.supporting_documents.errors else ""), multiple=True) }}
                            {% if form.supporting_documents.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.supporting_documents.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">
                                Téléchargez tous les documents nécessaires pour justifier votre demande :
                                pièce d'identité, justificatifs de domicile, etc.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Types de documents - Information -->
                    <div class="form-section mb-4">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card border-primary h-100">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-home me-2"></i>Attestation de Résidence
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text small">
                                            Certifie votre lieu de résidence actuel. 
                                            Requiert : justificatif de domicile récent.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card border-success h-100">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-heartbeat me-2"></i>Certificat de Vie
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text small">
                                            Atteste que vous êtes vivant à une date donnée. 
                                            Souvent requis pour les pensions.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card border-info h-100">
                                    <div class="card-header bg-info text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-flag me-2"></i>Attestation de Nationalité
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text small">
                                            Certifie votre nationalité congolaise. 
                                            Requiert : acte de naissance, pièce d'identité.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card border-warning h-100">
                                    <div class="card-header bg-warning text-dark">
                                        <h6 class="mb-0">
                                            <i class="fas fa-copy me-2"></i>Duplicata
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text small">
                                            Copie certifiée conforme d'un document consulaire. 
                                            Précisez le document original dans l'objet.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Informations personnelles du demandeur -->
                    <div class="form-section mb-4">
                        <div class="card border-light">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">
                                    <i class="fas fa-user me-2"></i>Informations du Demandeur
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <strong>Nom complet :</strong> {{ current_user.get_full_name() }}
                                    </div>
                                    <div class="col-md-6">
                                        <strong>Email :</strong> {{ current_user.email }}
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-6">
                                        <strong>Téléphone :</strong> {{ current_user.phone or 'Non renseigné' }}
                                    </div>
                                    <div class="col-md-6">
                                        <strong>Date d'inscription :</strong> {{ current_user.created_at.strftime('%d/%m/%Y') }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Conditions -->
                    <div class="form-section mb-4">
                        <div class="card border-warning">
                            <div class="card-body">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="acceptTerms" required>
                                    <label class="form-check-label" for="acceptTerms">
                                        Je certifie que les informations fournies sont exactes et que l'usage prévu du document est conforme à la réglementation en vigueur.
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Buttons -->
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Retour au tableau de bord
                        </a>
                        {{ form.submit(class="btn btn-secondary btn-lg") }}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const documentTypeSelect = document.getElementById('document_type');
    const documentTypeOtherField = document.getElementById('document_type_other_field');
    
    function toggleOtherField() {
        if (documentTypeSelect.value === 'autre') {
            documentTypeOtherField.style.display = 'block';
            documentTypeOtherField.querySelector('input').required = true;
        } else {
            documentTypeOtherField.style.display = 'none';
            documentTypeOtherField.querySelector('input').required = false;
        }
    }
    
    documentTypeSelect.addEventListener('change', toggleOtherField);
    toggleOtherField(); // Initial check
});
</script>
{% endblock %}
