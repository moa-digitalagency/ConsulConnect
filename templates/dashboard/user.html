{% extends "base.html" %}

{% block title %}Dashboard Citoyen - e-Consulaire RDC{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/corporate.css') }}">
{% endblock %}

{% block content %}
<div class="min-h-screen pattern-overlay">
    <!-- Header Corporate avec Navigation -->
    <header class="bg-white shadow-sm border-b-4 border-blue-600">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo et Titre -->
                <div class="flex items-center space-x-4">
                    <div class="logo-corporate w-14 h-14">
                        <i class="fas fa-flag text-2xl text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">e-Consulaire RDC</h1>
                        <p class="text-sm text-gray-600">Services Consulaires Numériques</p>
                    </div>
                </div>
                
                <!-- Informations Utilisateur -->
                <div class="flex items-center space-x-4">
                    <!-- Notifications -->
                    <button class="relative p-2 text-gray-600 hover:text-blue-600 transition">
                        <i class="fas fa-bell text-xl"></i>
                        {% if notifications %}
                        <span class="absolute top-0 right-0 w-3 h-3 bg-red-500 rounded-full"></span>
                        {% endif %}
                    </button>
                    
                    <!-- Profil Utilisateur -->
                    <div class="flex items-center space-x-3">
                        <div class="text-right">
                            <p class="text-sm font-semibold text-gray-900">{{ current_user.first_name }} {{ current_user.last_name }}</p>
                            <p class="text-xs text-gray-500">Citoyen</p>
                        </div>
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-blue-600"></i>
                        </div>
                    </div>
                    
                    <!-- Déconnexion -->
                    <a href="{{ url_for('logout') }}" class="btn-corporate-secondary px-4 py-2 text-sm">
                        <i class="fas fa-sign-out-alt mr-2"></i>Déconnexion
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenu Principal -->
    <div class="container mx-auto px-4 py-8">
        <!-- Message de Bienvenue -->
        <div class="mb-8 fade-in-corporate">
            <h2 class="text-3xl font-bold text-gray-900 mb-2">
                Bienvenue, {{ current_user.first_name }} ! 
            </h2>
            <p class="text-lg text-gray-600">Accédez à tous vos services consulaires en ligne</p>
        </div>

        <!-- Statistiques Rapides -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="card-corporate p-6 text-center slide-up-corporate">
                <div class="w-16 h-16 mx-auto mb-4 bg-blue-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-clipboard-list text-2xl text-blue-600"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900">{{ applications|length }}</h3>
                <p class="text-sm text-gray-600">Demandes Totales</p>
            </div>
            
            <div class="card-corporate p-6 text-center slide-up-corporate" style="animation-delay: 0.1s;">
                <div class="w-16 h-16 mx-auto mb-4 bg-yellow-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-hourglass-half text-2xl text-yellow-600"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900">
                    {{ applications|selectattr('status', 'equalto', 'en_traitement')|list|length }}
                </h3>
                <p class="text-sm text-gray-600">En Traitement</p>
            </div>
            
            <div class="card-corporate p-6 text-center slide-up-corporate" style="animation-delay: 0.2s;">
                <div class="w-16 h-16 mx-auto mb-4 bg-green-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-check-circle text-2xl text-green-600"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900">
                    {{ applications|selectattr('status', 'equalto', 'validee')|list|length }}
                </h3>
                <p class="text-sm text-gray-600">Validées</p>
            </div>
            
            <div class="card-corporate p-6 text-center slide-up-corporate" style="animation-delay: 0.3s;">
                <div class="w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-bell text-2xl text-red-600"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900">{{ notifications|length }}</h3>
                <p class="text-sm text-gray-600">Notifications</p>
            </div>
        </div>

        <!-- Services Disponibles -->
        <div class="mb-8">
            <h3 class="text-2xl font-bold text-gray-900 mb-6">Services Consulaires</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <!-- Carte Consulaire -->
                <div class="card-corporate p-6 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 cursor-pointer">
                    <div class="w-14 h-14 mb-4 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-id-card text-xl text-blue-600"></i>
                    </div>
                    <h4 class="font-semibold text-gray-900 mb-2">Carte Consulaire</h4>
                    <p class="text-sm text-gray-600 mb-4">Immatriculation et renouvellement</p>
                    <a href="{{ url_for('consular_card') }}" class="text-blue-600 font-medium text-sm hover:text-blue-700">
                        Faire une demande <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>

                <!-- Passeport -->
                <div class="card-corporate p-6 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 cursor-pointer">
                    <div class="w-14 h-14 mb-4 bg-red-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-passport text-xl text-red-600"></i>
                    </div>
                    <h4 class="font-semibold text-gray-900 mb-2">Passeport</h4>
                    <p class="text-sm text-gray-600 mb-4">Pré-demande en ligne</p>
                    <a href="{{ url_for('passport') }}" class="text-blue-600 font-medium text-sm hover:text-blue-700">
                        Faire une demande <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>

                <!-- Attestation de Prise en Charge -->
                <div class="card-corporate p-6 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 cursor-pointer">
                    <div class="w-14 h-14 mb-4 bg-yellow-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-hands-helping text-xl text-yellow-600"></i>
                    </div>
                    <h4 class="font-semibold text-gray-900 mb-2">Prise en Charge</h4>
                    <p class="text-sm text-gray-600 mb-4">Attestation officielle</p>
                    <a href="{{ url_for('care_attestation') }}" class="text-blue-600 font-medium text-sm hover:text-blue-700">
                        Faire une demande <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>

                <!-- Légalisations -->
                <div class="card-corporate p-6 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 cursor-pointer">
                    <div class="w-14 h-14 mb-4 bg-green-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-stamp text-xl text-green-600"></i>
                    </div>
                    <h4 class="font-semibold text-gray-900 mb-2">Légalisations</h4>
                    <p class="text-sm text-gray-600 mb-4">Certification de documents</p>
                    <a href="{{ url_for('legalizations') }}" class="text-blue-600 font-medium text-sm hover:text-blue-700">
                        Faire une demande <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>

                <!-- Laissez-passer d'urgence -->
                <div class="card-corporate p-6 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 cursor-pointer">
                    <div class="w-14 h-14 mb-4 bg-red-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-plane-departure text-xl text-red-600"></i>
                    </div>
                    <h4 class="font-semibold text-gray-900 mb-2">Laissez-passer</h4>
                    <p class="text-sm text-gray-600 mb-4">Document d'urgence</p>
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                        <i class="fas fa-exclamation-triangle mr-1"></i>Urgence
                    </span>
                </div>

                <!-- État Civil -->
                <div class="card-corporate p-6 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 cursor-pointer">
                    <div class="w-14 h-14 mb-4 bg-purple-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-file-contract text-xl text-purple-600"></i>
                    </div>
                    <h4 class="font-semibold text-gray-900 mb-2">État Civil</h4>
                    <p class="text-sm text-gray-600 mb-4">Transcriptions et actes</p>
                    <a href="#" class="text-blue-600 font-medium text-sm hover:text-blue-700">
                        Faire une demande <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>

                <!-- Procurations -->
                <div class="card-corporate p-6 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 cursor-pointer">
                    <div class="w-14 h-14 mb-4 bg-indigo-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-file-signature text-xl text-indigo-600"></i>
                    </div>
                    <h4 class="font-semibold text-gray-900 mb-2">Procurations</h4>
                    <p class="text-sm text-gray-600 mb-4">Actes notariés</p>
                    <a href="#" class="text-blue-600 font-medium text-sm hover:text-blue-700">
                        Faire une demande <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>

                <!-- Autres Documents -->
                <div class="card-corporate p-6 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 cursor-pointer">
                    <div class="w-14 h-14 mb-4 bg-gray-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-folder-open text-xl text-gray-600"></i>
                    </div>
                    <h4 class="font-semibold text-gray-900 mb-2">Autres Services</h4>
                    <p class="text-sm text-gray-600 mb-4">Documents divers</p>
                    <a href="{{ url_for('other_documents') }}" class="text-blue-600 font-medium text-sm hover:text-blue-700">
                        Voir plus <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Mes Démarches Récentes -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Demandes Récentes -->
            <div>
                <h3 class="text-xl font-bold text-gray-900 mb-4">Mes Démarches Récentes</h3>
                <div class="card-corporate p-6">
                    {% if applications %}
                    <div class="space-y-4">
                        {% for app in applications[:5] %}
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 rounded-full 
                                    {% if app.status == 'validee' %}bg-green-100{% elif app.status == 'en_traitement' %}bg-yellow-100{% elif app.status == 'rejetee' %}bg-red-100{% else %}bg-blue-100{% endif %} 
                                    flex items-center justify-center">
                                    <i class="fas 
                                        {% if app.service_type == 'consular_card' %}fa-id-card
                                        {% elif app.service_type == 'passport' %}fa-passport
                                        {% elif app.service_type == 'care_attestation' %}fa-hands-helping
                                        {% else %}fa-file{% endif %} 
                                        {% if app.status == 'validee' %}text-green-600{% elif app.status == 'en_traitement' %}text-yellow-600{% elif app.status == 'rejetee' %}text-red-600{% else %}text-blue-600{% endif %}">
                                    </i>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-900">{{ app.get_service_type_display() }}</p>
                                    <p class="text-sm text-gray-500">Réf: {{ app.reference_number }}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium 
                                    {% if app.status == 'validee' %}bg-green-100 text-green-800
                                    {% elif app.status == 'en_traitement' %}bg-yellow-100 text-yellow-800
                                    {% elif app.status == 'rejetee' %}bg-red-100 text-red-800
                                    {% else %}bg-blue-100 text-blue-800{% endif %}">
                                    {{ app.get_status_display() }}
                                </span>
                                <p class="text-xs text-gray-500 mt-1">{{ app.created_at.strftime('%d/%m/%Y') }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <a href="{{ url_for('list_applications') }}" class="block mt-4 text-center text-blue-600 font-medium hover:text-blue-700">
                        Voir toutes mes démarches <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                    {% else %}
                    <div class="text-center py-8">
                        <i class="fas fa-inbox text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">Aucune démarche en cours</p>
                        <a href="#" class="mt-4 inline-block text-blue-600 font-medium hover:text-blue-700">
                            Commencer une démarche <i class="fas fa-plus ml-1"></i>
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Notifications -->
            <div>
                <h3 class="text-xl font-bold text-gray-900 mb-4">Notifications</h3>
                <div class="card-corporate p-6">
                    {% if notifications %}
                    <div class="space-y-3">
                        {% for notif in notifications %}
                        <div class="flex items-start space-x-3 p-3 bg-blue-50 rounded-lg">
                            <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                            <div class="flex-1">
                                <p class="text-sm text-gray-900">{{ notif.title }}</p>
                                <p class="text-xs text-gray-600 mt-1">{{ notif.message }}</p>
                                <p class="text-xs text-gray-500 mt-2">{{ notif.created_at.strftime('%d/%m/%Y à %H:%M') }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-8">
                        <i class="fas fa-bell-slash text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">Aucune notification</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Actions Rapides -->
        <div class="mt-8 bg-blue-50 rounded-lg p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-4">Actions Rapides</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <a href="#" class="flex items-center space-x-3 p-3 bg-white rounded-lg hover:shadow-md transition">
                    <i class="fas fa-calendar-alt text-blue-600"></i>
                    <span class="text-sm font-medium text-gray-900">Prendre RDV</span>
                </a>
                <a href="#" class="flex items-center space-x-3 p-3 bg-white rounded-lg hover:shadow-md transition">
                    <i class="fas fa-qrcode text-green-600"></i>
                    <span class="text-sm font-medium text-gray-900">Vérifier Document</span>
                </a>
                <a href="{{ url_for('user_profile') }}" class="flex items-center space-x-3 p-3 bg-white rounded-lg hover:shadow-md transition">
                    <i class="fas fa-user-edit text-purple-600"></i>
                    <span class="text-sm font-medium text-gray-900">Mon Profil</span>
                </a>
                <a href="#" class="flex items-center space-x-3 p-3 bg-white rounded-lg hover:shadow-md transition">
                    <i class="fas fa-headset text-red-600"></i>
                    <span class="text-sm font-medium text-gray-900">Support</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-16 bg-gray-50 border-t">
        <div class="container mx-auto px-4 py-8">
            <div class="text-center">
                <p class="text-sm text-gray-600">&copy; 2025 République Démocratique du Congo</p>
                <p class="text-xs text-gray-500 mt-1">Ministère des Affaires Étrangères - Services Consulaires Numériques</p>
            </div>
        </div>
    </footer>
</div>
{% endblock %}