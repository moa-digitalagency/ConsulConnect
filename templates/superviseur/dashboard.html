{% extends "base.html" %}

{% block title %}Tableau de Bord Superviseur - e-Consulaire RDC{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/corporate.css') }}">
{% endblock %}

{% block content %}
<div class="min-h-screen pattern-overlay">
    <!-- Header Corporate -->
    <header class="bg-white shadow-sm border-b-4 border-red-600">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo et Titre -->
                <div class="flex items-center space-x-4">
                    <div class="logo-corporate w-14 h-14">
                        <i class="fas fa-shield-alt text-2xl text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Superviseur Système</h1>
                        <p class="text-sm text-gray-600">Gestion globale du système e-Consulaire</p>
                    </div>
                </div>
                
                <!-- Navigation -->
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">{{ current_user.get_full_name() }}</span>
                    <a href="{{ url_for('auth.logout') }}" class="btn-corporate-secondary px-4 py-2 text-sm">
                        <i class="fas fa-sign-out-alt mr-2"></i>Déconnexion
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenu Principal -->
    <div class="container mx-auto px-4 py-8">
        
        <!-- Statistiques Globales -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            
            <!-- Total Utilisateurs -->
            <div class="card-corporate p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Total Utilisateurs</p>
                        <p class="text-2xl font-bold text-gray-900">{{ stats.total_users }}</p>
                        <p class="text-xs text-green-600">{{ stats.active_users }} actifs</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-users text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>
            
            <!-- Unités Consulaires -->
            <div class="card-corporate p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Unités Consulaires</p>
                        <p class="text-2xl font-bold text-gray-900">{{ stats.total_unites }}</p>
                        <p class="text-xs text-green-600">{{ stats.active_unites }} actives</p>
                    </div>
                    <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-building text-yellow-600 text-xl"></i>
                    </div>
                </div>
            </div>
            
            <!-- Services -->
            <div class="card-corporate p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Services Consulaires</p>
                        <p class="text-2xl font-bold text-gray-900">{{ stats.total_services }}</p>
                        <p class="text-xs text-green-600">{{ stats.active_services }} actifs</p>
                    </div>
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-cogs text-green-600 text-xl"></i>
                    </div>
                </div>
            </div>
            
            <!-- Actions Rapides -->
            <div class="card-corporate p-6">
                <div class="text-center">
                    <h4 class="text-lg font-semibold text-gray-900 mb-4">Actions Rapides</h4>
                    <div class="space-y-2">
                        <a href="{{ url_for('superviseur_ajouter_utilisateur') }}" 
                           class="btn-corporate-primary w-full text-sm py-2">
                            <i class="fas fa-user-plus mr-2"></i>Nouvel Utilisateur
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Répartition des Rôles -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            
            <!-- Répartition par Rôle -->
            <div class="card-corporate p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">
                    <i class="fas fa-chart-pie mr-2 text-blue-600"></i>Répartition par Rôle
                </h3>
                <div class="space-y-3">
                    {% for role, count in roles_stats.items() %}
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            {% if role == 'usager' %}
                                <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                                <span class="text-gray-700">Usagers</span>
                            {% elif role == 'agent' %}
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                <span class="text-gray-700">Agents</span>
                            {% elif role == 'admin' %}
                                <div class="w-3 h-3 bg-yellow-500 rounded-full mr-3"></div>
                                <span class="text-gray-700">Administrateurs</span>
                            {% elif role == 'superviseur' %}
                                <div class="w-3 h-3 bg-red-500 rounded-full mr-3"></div>
                                <span class="text-gray-700">Superviseurs</span>
                            {% endif %}
                        </div>
                        <span class="font-semibold text-gray-900">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Menu de Gestion -->
            <div class="card-corporate p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">
                    <i class="fas fa-tasks mr-2 text-red-600"></i>Menu de Gestion
                </h3>
                <div class="grid grid-cols-1 gap-3">
                    <a href="{{ url_for('superviseur_utilisateurs') }}" 
                       class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-users text-blue-600 mr-3"></i>
                        <span class="font-medium">Gérer les Utilisateurs</span>
                    </a>
                    
                    <a href="{{ url_for('superviseur_unites') }}" 
                       class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-building text-yellow-600 mr-3"></i>
                        <span class="font-medium">Unités Consulaires</span>
                    </a>
                    
                    <a href="{{ url_for('superviseur_services') }}" 
                       class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-cogs text-green-600 mr-3"></i>
                        <span class="font-medium">Services Consulaires</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Dernières Actions (Audit Log) -->
        {% if recent_actions %}
        <div class="card-corporate p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-history mr-2 text-gray-600"></i>Dernières Actions
            </h3>
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Utilisateur</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Action</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Détails</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        {% for action in recent_actions %}
                        <tr>
                            <td class="px-4 py-2 text-sm text-gray-900">{{ action.user.get_full_name() if action.user else 'Système' }}</td>
                            <td class="px-4 py-2 text-sm">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    {{ action.action }}
                                </span>
                            </td>
                            <td class="px-4 py-2 text-sm text-gray-600">{{ action.details[:50] }}{% if action.details|length > 50 %}...{% endif %}</td>
                            <td class="px-4 py-2 text-sm text-gray-500">{{ action.timestamp.strftime('%d/%m/%Y %H:%M') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

    </div>
</div>
{% endblock %}